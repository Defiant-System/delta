let Anim={init(){},dispatch(t){let e=Anim,i;switch(t.type){case"start":e.cvs=t.canvas;e.ctx=e.cvs.getContext("2d");e.dispatch({type:"create-scene"});e.paused=true;e.active="lines";e.draw();break;case"pause":e.paused=true;break;case"resume":if(e.paused&&e.ctx){e.paused=false;e.draw()}break;case"set-active-mode":e.alpha={from:1,to:0,step:-.025,mode:t.mode};break;case"create-scene":e.grid={margin:{x:19,y:20},size:22,points:[],forces:[]};e.grid.yl=Math.round((e.cvs.height-e.grid.margin.y)/e.grid.size);e.grid.xl=Math.round((e.cvs.width-e.grid.margin.x)/e.grid.size);for(let t=0;t<e.grid.yl;t++){e.grid.points[t]=[];for(let i=0;i<e.grid.xl;i++){let s=i*e.grid.size+e.grid.margin.x,a=t*e.grid.size+e.grid.margin.y;e.grid.points[t].push(new Point(s,a))}}e.lines={perlin:new ClassicalNoise,variation:.0027,amp:560,maxLines:37,variators:[],startY:e.cvs.height>>1};for(let t=0,i=0;t<e.lines.maxLines;t++,i+=.025){e.lines.variators[t]=i}break;case"explode":e.grid.forces.push(new Explode(t.x,t.y,t.force));break}},update(t){let e=t.cvs.width,i=t.cvs.height;switch(t.active){case"lines":break;case"grid":t.grid.forces.map((t=>t.update()));t.grid.points.map((e=>{e.map((e=>{t.grid.forces.map((t=>{let i=t.x-e.x,s=t.y-e.y,a=i**2+s**2;if(a<=t.radius){e.x-=i/7;e.y-=s/7}}));let i=e.x-e.xo,s=e.y-e.yo;e.x-=i/21;e.y-=s/21}))}));break}},draw(){let t=Anim,e=t.cvs,i=t.ctx,s=Math.PI*2;i.clearRect(0,0,e.width,e.height);if(t.alpha){t.alpha.from+=t.alpha.step;i.globalAlpha=t.alpha.from;if(t.alpha.from<=t.alpha.to&&t.alpha.mode){t.active=t.alpha.mode;t.alpha={from:0,to:1,step:.025}}else if(t.alpha.from>=t.alpha.to&&!t.alpha.mode){delete t.alpha}}switch(t.active){case"grid":i.save();i.translate(.5,.5);i.strokeStyle="#7788dd44";t.grid.points.map((t=>{i.beginPath();i.moveTo(t[0].x,t[0].y);t.map((t=>i.lineTo(t.x,t.y)));i.stroke();i.closePath()}));for(let e=0,s=t.grid.xl;e<s;e++){i.beginPath();i.moveTo(t.grid.points[0][e].x,t.grid.points[0][e].y);for(let s=0,a=t.grid.yl;s<a;s++){i.lineTo(t.grid.points[s][e].x,t.grid.points[s][e].y)}i.stroke();i.closePath()}i.restore();break;case"lines":i.strokeStyle=`#aaddff33`;for(let s=0;s<=t.lines.maxLines;s++){i.beginPath();i.moveTo(-5,t.startY);for(let a=0;a<e.width;a++){let e=t.lines.perlin.noise(a*t.lines.variation+t.lines.variators[s],a*t.lines.variation,0);i.lineTo(a,t.lines.startY+t.lines.amp*e)}i.stroke();i.closePath();t.lines.variators[s]+=75e-5}break}if(!t.paused){t.update(t);requestAnimationFrame(t.draw)}}};Anim.init();self.onmessage=t=>Anim.dispatch(t.data);let Utils={random(t,e){return Math.random()*(e-t)+t},calculateDistance(t,e,i,s){let a=t-i,r=e-s;return Math.sqrt(a**2+r**2)}};class Point{constructor(t,e){this.x=t;this.y=e;this.xo=t;this.yo=e;this.vx=0;this.vy=0}}class Explode{constructor(t,e,i=1){this.x=t;this.y=e;this.v=2.25;this.force=50*i;this.decay=50*i}update(){this.decay--;this.radius=this.decay**this.v;if(this.acc>=this.force){let t=Anim.grid,e=t.forces.findIndex((t=>t==this));t.forces.splice(e,1)}}}class ClassicalNoise{constructor(t){if(t==undefined)t=Math;this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];this.p=[];for(let e=0;e<256;e++){this.p[e]=Math.floor(t.random()*256)}this.perm=[];for(let t=0;t<512;t++){this.perm[t]=this.p[t&255]}}dot(t,e,i,s){return t[0]*e+t[1]*i+t[2]*s}mix(t,e,i){return(1-i)*t+i*e}fade(t){return t*t*t*(t*(t*6-15)+10)}noise(t,e,i){let s=Math.floor(t);let a=Math.floor(e);let r=Math.floor(i);t=t-s;e=e-a;i=i-r;s=s&255;a=a&255;r=r&255;let h=this.perm[s+this.perm[a+this.perm[r]]]%12;let l=this.perm[s+this.perm[a+this.perm[r+1]]]%12;let o=this.perm[s+this.perm[a+1+this.perm[r]]]%12;let d=this.perm[s+this.perm[a+1+this.perm[r+1]]]%12;let p=this.perm[s+1+this.perm[a+this.perm[r]]]%12;let n=this.perm[s+1+this.perm[a+this.perm[r+1]]]%12;let m=this.perm[s+1+this.perm[a+1+this.perm[r]]]%12;let c=this.perm[s+1+this.perm[a+1+this.perm[r+1]]]%12;let g=this.dot(this.grad3[h],t,e,i);let f=this.dot(this.grad3[p],t-1,e,i);let x=this.dot(this.grad3[o],t,e-1,i);let u=this.dot(this.grad3[m],t-1,e-1,i);let v=this.dot(this.grad3[l],t,e,i-1);let y=this.dot(this.grad3[n],t-1,e,i-1);let k=this.dot(this.grad3[d],t,e-1,i-1);let b=this.dot(this.grad3[c],t-1,e-1,i-1);let w=this.fade(t);let M=this.fade(e);let P=this.fade(i);let A=this.mix(g,f,w);let T=this.mix(v,y,w);let z=this.mix(x,u,w);let C=this.mix(k,b,w);let L=this.mix(A,z,M);let Y=this.mix(T,C,M);let q=this.mix(L,Y,P);return q}}